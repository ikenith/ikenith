<!doctype html>
<html lang="en" class="dark">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>The 01</title>

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&family=Poppins:wght@600;700&display=swap"
    rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    body {
      background: #0a0a0f;
      color: #e5e7eb;
      font-family: Inter, system-ui, sans-serif;
    }

    .main-title {
      font-family: Poppins, Inter, sans-serif;
      font-size: 2.7rem;
      font-weight: 700;
      color: #fff;
      text-align: center;
      margin-top: 2.5rem;
      margin-bottom: 0.5rem;
    }

    .post-list {
      max-width: 700px;
      margin: 2rem auto;
    }

    .post-card {
      background: #18181b;
      border-radius: 1.2rem;
      padding: 1.3rem 2rem;
      margin-bottom: 1.2rem;
      display: flex;
      flex-direction: column;
      align-items: center;
      transition: background-color 0.2s;
    }

    .post-card:hover {
      background: #23272a;
    }

    .post-title-link {
      font-size: 1.3rem;
      font-weight: 600;
      color: #fff;
      text-decoration: none;
      font-family: Poppins, Inter, sans-serif;
      transition: color 0.2s;
    }

    .post-title-link:hover {
      color: #0ea5e9;
    }

    .post-date {
      color: #bcbcbc;
      font-size: 1rem;
      margin-top: 0.2rem;
      font-family: Inter, sans-serif;
    }
  </style>
</head>

<body>
  <div class="main-title">The 01</div>
  <div id="posts" class="post-list"></div>
  <script>
    const repo = "ikenith/ikenith.github.io";
    const branch = "main";

    // Helper to parse YAML frontmatter
    function parseFrontmatter(md) {
      const match = md.match(/^---\s*([\s\S]*?)---/);
      let meta = {};
      if (match) {
        const lines = match[1].split('\n');
        lines.forEach(line => {
          const [key, ...rest] = line.split(':');
          if (key && rest.length) {
            meta[key.trim()] = rest.join(':').trim().replace(/^"|"$/g, '');
          }
        });
      }
      return meta;
    }

    async function loadPosts() {
      const postsContainer = document.getElementById("posts");
      postsContainer.innerHTML = `<div style="text-align:center;color:#bcbcbc;">Loading...</div>`;
      try {
        const res = await fetch(`https://api.github.com/repos/${repo}/contents/posts?ref=${branch}`);
        if (!res.ok) throw new Error("GitHub API request failed: " + res.status);
        const files = await res.json();

        // Only .md files
        const mdFiles = files.filter(f => f.name.endsWith(".md"));

        // Fetch metadata for each post
        const posts = await Promise.all(mdFiles.map(async file => {
          const res = await fetch(`https://api.github.com/repos/${repo}/contents/${file.path}?ref=${branch}`);
          if (!res.ok) return null;
          const data = await res.json();
          const md = atob(data.content.replace(/\n/g, ''));
          const meta = parseFrontmatter(md);
          return {
            title: meta.title || file.name.replace(".md", ""),
            date: meta.date || "",
            image: meta.image || "",
            path: file.path
          };
        }));

        // Sort by date descending (newest first)
        posts.sort((a, b) => (b.date || '').localeCompare(a.date || ''));

        postsContainer.innerHTML = "";
        posts.forEach(post => {
          if (!post) return;
          postsContainer.innerHTML += `
            <div class="post-card">
              ${post.image ? `
                <div style="
                  width: 100%;
                  max-width: 360px;
                  margin-bottom: 1.1rem;
                  border-radius: 1.1rem;
                  overflow: hidden;
                  display: flex;
                  justify-content: center;
                  align-items: center;
                  background: #23272a;
                ">
                  <img src="${post.image}" alt="Post image" style="width: 100%; height: 180px; object-fit: cover; border-radius: 1.1rem;">
                </div>
              ` : ''}
              <a class="post-title-link" href="post.html?file=${encodeURIComponent(post.path)}">${post.title}</a>
              <div class="post-date">${post.date}</div>
            </div>
          `;
        });

        if (posts.length === 0) {
          postsContainer.innerHTML = `<div style="text-align:center;color:#bcbcbc;">No posts yet.</div>`;
        }
      } catch (err) {
        postsContainer.innerHTML = `<div style="text-align:center;color:#f87171;">Failed to load posts.</div>`;
      }
    }

    loadPosts();
  </script>
</body>

</html>