<!doctype html>
<html lang="en" class="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Editor | The 01</title>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&family=Poppins:wght@600;700&display=swap"
        rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        body {
            background: #0a0a0f;
            color: #e5e7eb;
            font-family: Inter, system-ui, sans-serif;
        }

        .editor-card {
            background: #18181b;
            border-radius: 1.5rem;
            padding: 2rem;
            max-width: 820px;
            margin: 2rem auto;
        }

        textarea {
            width: 100%;
            min-height: 200px;
            background: #23272a;
            color: #fff;
            border-radius: 1rem;
            padding: 1.2rem 1rem 1rem 2rem;
            /* top, right, bottom, left */
            border: none;
            resize: vertical;
            font-size: 1.08rem;
            outline: none;
            transition: background 0.2s;
        }

        textarea::placeholder {
            color: #bcbcbc;
            text-indent: 2rem;
            /* shifts only the placeholder text */
            opacity: 1;
        }

        textarea:focus {
            background: #23272a;
        }

        .preview {
            background: #23272a;
            border-radius: 1rem;
            padding: 1.2rem 1rem 1rem 2rem;
            /* top, right, bottom, left */
            margin-top: 1rem;
            min-height: 120px;
            color: #e0e7ef;
            font-size: 1.05rem;
        }

        .toolbar button {
            background: #23272a;
            color: #fff;
            border: none;
            border-radius: 0.7rem;
            padding: 0.5rem 0.85rem;
            margin-right: 0.5rem;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            transition: background 0.2s, color 0.2s, transform 0.2s;
        }

        .toolbar button:hover {
            background: #fff;
            color: #23272a;
            transform: translateY(-2px) scale(1.05);
        }

        .tips {
            font-size: 1rem;
            color: #fff;
            margin-top: 2rem;
            background: #23272a;
            border-radius: 1rem;
            padding: 1.1rem 1.4rem;
            opacity: 0.96;
            display: flex;
            align-items: flex-start;
            gap: 0.7rem;
        }

        .tips-icon {
            flex-shrink: 0;
            margin-top: 2px;
            color: #fff;
            font-size: 1.3rem;
        }

        .tips-content {
            flex: 1;
        }

        .tips code {
            background: #fff;
            color: #23272a;
            padding: 2px 8px;
            border-radius: 6px;
            margin: 0 2px;
            font-size: 0.97em;
            font-weight: 500;
            border: none;
        }
    </style>
</head>

<body>
    <main>
        <div class="editor-card">
            <!-- Logo and Title -->
            <div class="flex items-center gap-3 mb-6">
                <!-- Markdown SVG logo -->
                <span class="inline-block">
                    <svg width="38" height="38" viewBox="0 0 38 38" fill="none">
                        <rect width="38" height="38" rx="12" fill="#23272a" />
                        <text x="7" y="27" font-size="22" font-family="monospace" fill="#fff">MD</text>
                    </svg>
                </span>
                <h1 class="text-3xl font-bold text-white">Markdown Editor</h1>
            </div>
            <!-- Post Metadata -->
            <div class="mb-4 flex flex-col gap-3">
                <input type="text" id="post-title" placeholder="Post Title"
                    class="bg-[#23272a] text-white rounded-full px-5 py-3 border-none outline-none text-lg"
                    autocomplete="off" />
                <div class="flex gap-3">
                    <select id="post-year"
                        class="bg-[#23272a] text-white rounded-full px-5 py-3 border-none outline-none text-lg">
                        <option value="" disabled selected>Year</option>
                        <script>
                            const yearSelect = document.currentScript.parentElement;
                            for (let y = 2015; y <= 2030; y++) {
                                const opt = document.createElement('option');
                                opt.value = y;
                                opt.textContent = y;
                                yearSelect.appendChild(opt);
                            }
                        </script>
                    </select>
                    <select id="post-month"
                        class="bg-[#23272a] text-white rounded-full px-5 py-3 border-none outline-none text-lg">
                        <option value="" disabled selected>Month</option>
                        <option value="01">Jan</option>
                        <option value="02">Feb</option>
                        <option value="03">Mar</option>
                        <option value="04">Apr</option>
                        <option value="05">May</option>
                        <option value="06">Jun</option>
                        <option value="07">Jul</option>
                        <option value="08">Aug</option>
                        <option value="09">Sep</option>
                        <option value="10">Oct</option>
                        <option value="11">Nov</option>
                        <option value="12">Dec</option>
                    </select>
                    <select id="post-day"
                        class="bg-[#23272a] text-white rounded-full px-5 py-3 border-none outline-none text-lg">
                        <option value="" disabled selected>Day</option>
                        <script>
                            const daySelect = document.currentScript.parentElement;
                            for (let d = 1; d <= 31; d++) {
                                const opt = document.createElement('option');
                                opt.value = d.toString().padStart(2, '0');
                                opt.textContent = d;
                                daySelect.appendChild(opt);
                            }
                        </script>
                    </select>
                </div>
            </div>
            <!-- Toolbar -->
            <div class="toolbar mb-3 flex flex-wrap gap-2">
                <button onclick="insertMd('**', '**')"><b>B</b></button>
                <button onclick="insertMd('*', '*')"><i>/</i></button>
                <button onclick="insertMd('`', '`')">Code</button>
                <button onclick="insertMd('![alt text](', ')')">Image</button>
                <button onclick="insertMd('[Link](', ')')">Link</button>
                <button onclick="insertMd('\n# ', '')">H1</button>
                <button onclick="insertMd('\n## ', '')">H2</button>
                <button onclick="insertMd('\n- ', '')">List</button>
            </div>
            <!-- Editor -->
            <textarea id="md-input" placeholder="Write your post in markdown..."></textarea>
            <div class="preview mt-6" id="md-preview"></div>
            <!-- Save Button -->
            <div class="flex gap-3 mb-4 mt-6">
                <button id="save-btn" class="bg-[#23272a] text-white rounded-full px-7 py-3 font-semibold text-lg shadow-none border-none outline-none transition
            hover:bg-white hover:text-[#23272a] hover:scale-105 focus:ring-2 focus:ring-white/30 focus:outline-none">
                    Save
                </button>
            </div>
            <!-- Tips -->
            <div class="tips mt-8">
                <span class="tips-icon">
                    <svg width="22" height="22" viewBox="0 0 22 22" fill="none">
                        <circle cx="11" cy="11" r="10" fill="#18181b" />
                        <path d="M11 4a5 5 0 0 1 5 5c0 2.5-2 4-2 5.5a1 1 0 0 1-2 0c0-1.5-2-3-2-5.5a5 5 0 0 1 5-5z"
                            stroke="#fff" stroke-width="1.5" />
                        <rect x="9" y="16" width="4" height="2" rx="1" fill="#fff" />
                    </svg>
                </span>
                <span class="tips-content">
                    <b>Markdown Tips:</b><br>
                    <code>**bold**</code> <code>*italic*</code> <code>`code`</code> <code>![alt](url)</code>
                    <code>[text](url)</code><br>
                    <code># Heading 1</code> <code>## Heading 2</code> <code>- List item</code>
                </span>
            </div>
        </div>
    </main>
    <script>
        const input = document.getElementById('md-input');
        const preview = document.getElementById('md-preview');
        input.addEventListener('input', () => {
            preview.innerHTML = marked.parse(input.value);
        });
        preview.innerHTML = marked.parse(input.value);

        // Insert markdown at cursor
        window.insertMd = function (before, after) {
            const start = input.selectionStart;
            const end = input.selectionEnd;
            const value = input.value;
            const selected = value.substring(start, end);
            let insertText = before + selected + after;
            // For headings/lists, don't wrap selection
            if ((before.startsWith('\n') || before === '- ') && !selected) insertText = before;
            input.value = value.substring(0, start) + insertText + value.substring(end);
            input.focus();
            // Move cursor after inserted text
            const cursorPos = start + insertText.length;
            input.setSelectionRange(cursorPos, cursorPos);
            // Update preview
            preview.innerHTML = marked.parse(input.value);
        }

        input.addEventListener('focus', function () {
            if (input.value === '') {
                input.value = '    '; // 4 spaces (1 tab)
                input.setSelectionRange(4, 4); // Move cursor after spaces
            }
        });

        function getDateString() {
            const y = document.getElementById('post-year').value;
            const m = document.getElementById('post-month').value;
            const d = document.getElementById('post-day').value;
            return y && m && d ? `${y}-${m}-${d}` : '';
        }

        function getPostData() {
            return {
                title: document.getElementById('post-title').value.trim(),
                date: getDateString(),
                markdown: document.getElementById('md-input').value
            };
        }

        document.getElementById('save-btn').onclick = async function () {
            const post = getPostData();

            // Check for empty fields
            if (!post.title) {
                alert("Please enter a post title.");
                return;
            }
            if (!post.date) {
                alert("Please select year, month, and day.");
                return;
            }
            if (!post.markdown.trim()) {
                alert("Please write some markdown content.");
                return;
            }
            if (!githubToken) promptToken();
            if (!githubToken) return alert("No token provided.");

            // Prepare markdown with YAML frontmatter
            const content = `---\ntitle: "${post.title}"\ndate: "${post.date}"\n---\n\n${post.markdown}`;
            const path = `posts/${post.title.replace(/\s+/g, '-').toLowerCase()}.md`;

            // Get SHA if file exists (for update)
            let sha = null;
            try {
                const res = await fetch(`https://api.github.com/repos/ikenith/ikenith.github.io/contents/${path}`);
                if (res.ok) {
                    const data = await res.json();
                    sha = data.sha;
                }
            } catch { }

            // Create or update file
            const response = await fetch(`https://api.github.com/repos/ikenith/ikenith.github.io/contents/${path}`, {
                method: "PUT",
                headers: {
                    "Authorization": `token ${githubToken}`,
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    message: `Add post: ${post.title}`,
                    content: btoa(unescape(encodeURIComponent(content))),
                    sha: sha || undefined
                })
            });

            if (response.ok) {
                alert("Post saved to GitHub!");
            } else {
                const error = await response.json();
                alert("Failed to save post.\n" + (error.message || JSON.stringify(error)));
            }
        };

        let githubToken = '';

        function promptToken() {
            githubToken = prompt("Enter your GitHub Personal Access Token:");
        }
    </script>
</body>

</html>